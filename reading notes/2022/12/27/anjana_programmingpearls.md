## Chapter 9: 代码调优

### 高速缓存

性能监视：程序大部分时间都花在内存分配函数malloc上了。

在内存分配程序中插入几行计数代码后，发现最常见记录类型的空间分配次数是次常见记录类型的30倍。

解决方法：应用高速缓存，将最常见类型的空闲记录缓存在一个`链表`中。

通过性能监视识别出程序中的“热点”，然后使用高速缓存减少其运行时间。

## 急救方案

### 整数取模%

C语言的模运算符%开销较大：大多数算术运算需要约10ns，而模运算需要约100ns。

```c
k=(j+rotdist)%n;
可以改为：
k=j+rotdist;
if(k>=n) k-=n; 
```

rotdist=1 程序的运行时间：从119ns下降至57ns，速度几乎提高了一倍。

rotdist=10 程序的运行时间都是206ns。

原因：

rotdist=1 算法顺序访问内存，模运算决定了程序的运行时间。

rotdist=10 代码在内存中每隔10个字才访问一次，因此大部分运行时间用于将RAM内容读入高速缓存。 

对内存的访问占用了大量的运行时间，减少计算时间是毫无意义的。