##### visibility rules for observing a consistent snapshot
当事务读数据库时，通过事务 ID 可以决定哪些对象可见，哪些不可见。可见性规则如下：
1. 事务开始时，数据库会列出当前正在进行的其它事务（尚未提交或中止），然后忽略这些事务所完成的部分写入。
2. 所有中止事务所做的修改全部不可见。
3. 较晚事务 ID （晚于当前事务）所做的任何修改都不可见，不论其是否完成了提交。
4. 除此之外，其它所有的写入都对当前查询可见。

当以下两个条件满足时，该数据对象对事务可见：
* 事务开始的时刻，创建该对象的事务已经完成了提交。
* 对象没有被标记为删除；或者已经标记删除了，但删除事务在当前事务开始时并未提交。

长时间运行的事务可能会使用快照很长时间，但其没有发生原地更新，每次修改总创建一个新版本，因此数据库的开销较小。

##### Index and snapshot isolation
snapshot isolation 如何支持索引：
###### 方式一：
索引直接指向对象的所有版本，然后想办法过滤对当前事务不可见的哪些版本。后台的垃圾回收进程来决定删除某个旧对象版本时，对应的索引条目也需要随之删除。

具体实现：PostgreSQL 采取该方式，把同一对象的不同版本放在一个内存页上，避免更新索引。

###### 方式二：
B-Tree + 追加/写时复制技术。当需要更新时，不会修改现有的页面，也是创建一个新的修改副本，拷贝必要的内容，然后让父节点，或者递归向上直到树的 root 节点都指向新创建的节点。那些不受影响的页面都不需要复制，保持不变并被父节点所指向。

这种方式不需要根据事务 ID 过滤某些对象，但仍然需要后台进程来执行压缩和垃圾回收。

CouchDB, Datomic 和 LMDB 使用该方法。

##### repeatable read and naming confusion

snapshot isolation 的命名标准没有统一，Oracle 称之为可串行化，PostgreSQL 和 MySQL 称之为可重复读。
