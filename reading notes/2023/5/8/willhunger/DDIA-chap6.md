### Rebalaning Partitions
再平衡（动态平衡）：将数据和请求从一个节点迁移到另一个节点。
再平衡需满足以下条件：
1. 平衡后，负载、数据存储、读写请求等应该在集群范围内更均匀地分布；
2. 再平衡执行过程中，数据库应该继续正常提供读写服务；
3. 避免不必要的负载迁移，减少网络和磁盘 I/O。


#### 1. Stargies for Rebalancing
##### How not to do it: hash mod N
为什么不用取模的平衡方式：节点数发生变化后，会导致频繁迁移。

##### Fixed number of partitions
创建远超实际节点数的分区数，为每个节点分配多个分区。

在发生分区迁移时，分区会在节点之间迁移，但分区的总数量维持不变。（旧分区荏苒可以接收读写请求。）
> 可以在性能较强的机器上配置多个分区，承担更多负载。

![[assests/Pasted image 20230506000013.png]]

使用该方式的数据库：Riak, Elasticsearch, Couchbase, Voldemort 都支持。

不足之处：
1. 分区的数量在数据库创建之初就需确定好。如果分区数量较小，后续拆分合并困难；如果分区数量较大，了能有较大的副作用。
2. 如果分区里的数据量非常大， 则每次再平衡和节点故障恢复的代价就很大；但是如果一个分区太小， 就会产生太多的开销。
3. 对于采用 key range partitioning 的数据库，如果采用该方式进行 rebalancing，极端情况下，所有数据可能在一个分区中，而其它分区为空。（手动配置调整分区边界较为复杂）