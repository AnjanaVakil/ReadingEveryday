### Chapter 3：A FRAMEWORK FOR SYSTEM DESIGN INTERVIEWS

系统设计面试往往令人望而生畏。面试的内容可能很模糊，比如 "设计一个众所周知的 X 产品？ 问题模棱两可，似乎宽泛得不合理。出现疲惫是可以理解的。毕竟，怎么可能有人在一小时内设计出一款流行产品 的流行产品？

好消息是，没有人会期望你这样做。现实世界的系统设计极其复杂。例如，谷歌搜索简单得令人难以置信；然而，支撑这种简单性的技术之多确实令人吃惊。如果没人指望你在一小时内设计出一个真实世界的系统，那么系统设计面试又有什么好处呢？

系统设计面试模拟了现实生活中的问题解决方式，即两个同事合作解决一个模糊的问题，并提出一个符合他们目标的解决方案。问题是开放式的，没有完美的答案。与你在设计过程中付出的努力相比，最终的设计并不那么重要。这可以让你展示自己的设计技能，为自己的设计选择辩护，并以建设性的方式回应反馈意见。

让我们翻转一下桌面，想想当面试官走进会议室与你见面时，她的脑子里在想些什么。面试官的首要目标是准确评估你的能力。她最不愿意看到的情况是，由于面试过程不顺利，面试材料不充足，而给出一个没有结论的评估。因为会议进行得不顺利，没有足够的信号。面试官在系统设计面试中寻找什么？

很多人认为，系统设计面试就是考察一个人的技术设计能力。其实远不止于此。一个有效的系统设计面试会发出强烈的信号，显示一个人的协作能力、在压力下工作的能力以及建设性地解决模糊问题的能力。提出好问题的能力也是一项基本技能，许多面试官都会特别考察这项技能。

好的面试官也会发现一些 "红旗"。过度工程化是许多 因为他们乐于追求设计的纯粹性，而忽略了权衡利弊。他们往往没有意识到过度设计系统的复合成本，许多公司为此付出了高昂的代价。你肯定不希望在系统设计面试中表现出这种倾向。其他警示还包括思想狭隘、固执己见等。

#### A 4-step process for effective system design interview

每个系统设计面试都不尽相同。优秀的系统设计面试是开放式的，没有放之四海而皆准的解决方案。不过，每次系统设计面试都有一些步骤和共同点。

#### Step 1 - Understand the problem and establish design scope

-   “老虎为什么吼叫？”

-   班级后面有人举起了手。
-   "是的，吉米？"老师回答道。
-   "因为他饿了"
-   “非常好，吉米。”

在吉米的童年生活中，他总是第一个在课堂上回答问题。每当老师提问时，教室里总有一个孩子不管自己是否知道答案，都喜欢抢着回答问题。这就是吉米。

吉米是个王牌学生。他以快速知道所有答案为荣。在考试中，他通常是第一个答完题的人。在任何学科竞赛中，他都是老师的首选。竞赛的首选。

不要像吉米那样。（...6）

在系统设计面试中，不假思索地快速给出答案不会给你加分。在没有透彻理解需求的情况下回答问题是一个很大的问题，因为面试不是小题竞赛。没有正确的答案。

因此，不要马上跳出来给出解决方案。放慢脚步。深入思考并提出问题，以澄清需求和假设。这一点极为重要。

作为一名工程师，我们喜欢解决棘手的问题并投入到最终的设计中；然而，这种方法很可能会导致你设计出错误的系统。作为工程师，最重要的技能之一就是提出正确的问题，做出适当的假设，并收集构建系统所需的所有信息。因此，不要害怕提问。

当您提问时，面试官要么直接回答您的问题，要么要求您做出假设。如果是后者，请在白板或纸上写下您的假设。您以后可能会用到它们。

要问什么样的问题？通过提问来了解确切的要求。以下是问题清单，以帮助您入门：

-   我们要构建哪些具体功能？
-   产品有多少用户？
-   公司预计以多快的速度扩大规模？预计在 3 个月、6 个月和 1 年后的预期规模是多少？
-   公司的技术栈是什么？您可以利用哪些现有服务来简化设计？

##### Example

如果面试官要求你设计一个新闻源系统，你需要提出一些问题来帮助澄清需求。你和面试官之间的对话可能是这样的：

-   Candidate: 这是移动端？还是web端？还是都是？
-   Interviewer: 都是
-   Candidate: 产品最重要的功能是什么？
-   Interviewer: 发帖子和看朋友的新闻源
-   Candidate: 新闻源是按时间倒序还是特定顺序排列？特定顺序特定顺序意味着每个帖子的权重不同。例如，您的好友的帖子比某个群组的帖子更重要。
-   Interviewer: 为了简单起见，我们假设信息源按时间倒序排序。
-   Candidate: 一个用户可以有多少好友？
-   Interviewer: 5000
-   Candidate: 流量有多大？
-   Interviewer: 1,000 万日活跃用户 (DAU)
-   Candidate: feed 是否可以包含图片、视频或纯文字？
-   Interviewer: 它可以包含媒体文件，包括图像和视频。

以上是您可以向面试官提出的一些示例问题。重要的是了解要求并澄清模糊之处

#### Step 2 - Propose high-level design and get buy-in

在这一步中，我们的目标是制定一个高层次的设计方案，并与面试官就设计方案达成一致。在此过程中，与面试官合作是个不错的主意。

-   提出设计的初步蓝图。征求反馈意见。把面试官当作队友，一起工作。许多优秀的面试官都喜欢谈论和参与 参与其中。
-   在白板或纸上绘制包含关键组件的框图。这可能包括客户端（移动/网络）、应用程序接口、网络服务器、数据存储、缓存、CDN、消息队列等。
-   进行反向计算，评估你的蓝图是否符合比例限制。大声思考。如果有必要进行包底计算，请先与面试官沟通，然后再深入研究。

如果可能的话，先看几个具体的使用案例。这将有助于你确定高层次设计的框架。这些用例还可能帮助你发现尚未考虑的边缘情况。

我们是否应该在这里包含应用程序接口端点和数据库模式？这取决于问题的具体情况。对于像 "设计谷歌搜索引擎 "这样的大型设计问题来说，这有点太低级了。而对于为多人扑克游戏设计后台这样的问题来说，这就很公平了。与面试官沟通。

##### Example

让我们用 "设计一个新闻源系统 "来演示如何进行高级设计。在这里，你不需要了解系统的实际工作原理。

在高层次上，设计分为两个流程：新闻源发布和新闻源构建。

-   Feed 发布：当用户发布帖子时，相应的数据会被写入缓存/数据库，帖子会被填充到好友的新闻源中。
-   新闻推送的构建：新闻推送是通过将好友的帖子按照相反的顺序聚合起来而构建的。

![](https://inasa.dev/image/systemdesign/03/1.png)

![](https://inasa.dev/image/systemdesign/03/2.png)



#### Step 3 - Design deep dive

在这一步，您和面试官应该已经实现了以下目标：

-   商定总体目标和功能范围
-   勾勒出整体设计的高层次蓝图
-   获得面试官对高层次设计的反馈意见
-   根据她的反馈意见，对深度挖掘的重点领域有了一些初步想法

您应与面试官一起确定架构中的各个组件并排定优先顺序。值得强调的是，每次面试都是不同的。有时，面试官可能会暗示她喜欢关注高层设计。有时，对于资深候选人的面试，讨论的可能是系统性能特征，重点可能是瓶颈和资源估算。在大多数情况下，面试官可能希望你深入探讨一些系统组件的细节。对于 URL 缩短器，深入研究将长 URL 转换为短 URL 的哈希函数设计是很有意思的。对于聊天系统，如何减少延迟以及如何支持在线/离线状态是两个有趣的话题。

时间管理非常重要，因为您很容易被一些微小的细节所迷惑，而这些细节并不能展示您的能力。您必须准备好向面试官展示自己的信号。尽量不要涉及不必要的细节。例如，在系统设计面试中，详细谈论 Facebook feed 排名的 EdgeRank 算法并不理想，因为这会耗费很多宝贵的时间，也无法证明你设计可扩展系统的能力。

##### Example

至此，我们已经讨论了新闻源系统的高层次设计，面试官对您的提议表示满意。接下来，我们将研究两个最重要的 用例：

-   Feed publishing
-   News feed retrieval

![](https://inasa.dev/image/systemdesign/03/3.png)

![](https://inasa.dev/image/systemdesign/03/4.png)



#### Step 4 - Wrap up

在这最后一步，面试官可能会问你一些后续问题，或让你自由讨论其他要点。以下是一些应遵循的方向：

-   面试官可能希望你找出系统瓶颈，并讨论可能的改进措施。千万不要说你的设计是完美的，没有什么可以改进的。总有一些地方需要改进。这是展示您的批判性思维并留下良好印象的好机会。
-   向面试官简要介绍您的设计可能会有所帮助。如果你提出了一些解决方案，这一点尤为重要。在长时间的讨论后，让面试官恢复记忆会很有帮助。在长时间的讨论后，这很有帮助。
-   错误案例（服务器故障、网络丢失等）的讨论很有意思。
-   运行问题值得一提。如何监控指标和错误日志？如何展开系统？
-   如何处理下一条比例曲线也是一个有趣的话题。例如，如果您当前的设计可支持 100 万用户，那么要支持 1000 万用户，您需要做出哪些改变？千万用户？
-   如果时间充裕，请提出您需要的其他改进建议。

最后，我们总结了一份 "该做 "和 "不该做 "的清单。

Dos

-   一定要问清楚。不要认为自己的假设是正确的。
-   了解问题的要求。
-   既没有正确答案，也没有最佳答案。为解决年轻初创公司的问题而设计的解决方案与为解决拥有数百万用户的成熟公司的问题而设计的解决方案是不同的。确保您了解需求。
-   让面试官知道你在想什么。与面试官沟通。
-   如果可能，建议采用多种方法。
-   一旦您与面试官就蓝图达成一致，请详细介绍每个组成部分。先设计最关键的部分。
-   与面试官交流想法。好的面试官会把你当做队友。
-   Never give up.(...6)

Don’ts

-   不要对典型的面试问题毫无准备。
-   在未明确需求和假设之前，不要贸然使用解决方案。
-   一开始不要过多地介绍某个部分的细节。先给出高设计，然后再深入研究。
-   如果遇到困难，不要犹豫，请寻求提示。
-   还是那句话，沟通。不要在沉默中思考。
-   不要以为设计好了，面试就结束了。直到面试官说你完成了，你才算完成了。尽早并经常征求反馈意见。



#### Time allocation on each step

系统设计面试问题通常非常宽泛，45 分钟或一个小时不足以涵盖整个设计。时间管理至关重要。你应该在每个步骤上花多少时间？以下是 45 分钟面试时间分配的粗略指南。请记住，这只是一个粗略的估计，实际的时间分配取决于问题的范围和面试官的要求。

-   步骤 1 了解问题并确定设计范围： 3 - 10 分钟
-   步骤 2 提出高层次设计方案并获得支持：10 - 15 分钟
-   步骤 3 深度设计：10 - 25 分钟
-   步骤 4 总结： 3 - 5 分钟



Pp. 42-50