通道

-   一个容量为0的通道值称为一个非缓冲通道（`unbuffered channel`），一个容量不为0的通道值称
    为一个缓冲通道（`buffered channel`）
-   通道类型的零值也使用预声明的`nil`来表示。 一个非零通道值必须通过内置的`make`函数来创建
-   所有通道类型均为可比较类型



通道操作

| 操作     | 零值nil通道 | 非零值但已关闭的通道 | 非零值且尚未关闭的通道 |
| -------- | ----------- | -------------------- | ---------------------- |
| 关闭     | 产生恐慌    | 产生恐慌             | 成功关闭C              |
| 发送数据 | 永久阻塞    | 产生恐慌             | 阻塞或者成功发送B      |
| 接收数据 | 永久阻塞    | 永不阻塞D            | 阻塞或者成功接收A      |

通道类型的大致内部实现

-   一个通道内部维护了三个队列（均可被视为先进先出队列）
-   接收数据协程队列
    -   此队列是一个没有长度限制的链表
    -   此队列中的协程均处于阻塞状态，它们正等待着从此通道接收数据
-   发送数据协程队列
    -   此队列也是一个没有长度限制的链表
    -   此队列中的协程亦均处于阻塞状态，它们正等待着向此通道发送数据
    -   此队列中的每个协程将要发送的值（或者此值的指针）和此协程一起存储在此队列中
-   数据缓冲队列
    -   循环队列，长度为此通道的容量
-   每个通道内部维护着一个互斥锁用来在各种通道操作中防止数据竞争



通道的元素值的传递都是复制过程

-   一个值被从一个协程传递到另一个协程的过程中，此值将被复制至少一次
-   如果传递值在某个通道的缓冲队列中停留过，则它在此传递过程中将被复制两次。一次复制发生在从发送协程向缓冲队列推入此值的时候，另一个复制发生在接收协程从缓冲队列取出此值的时候，只有它的直接部分被复制
-   对于官方标准编译器，最大支持的通道的元素类型的尺寸为65535



关于通道和协程的垃圾回收

-   一个通道被其发送数据协程队列和接收数据协程队列中的所有协程引用着
-   一个通道的两个队列只要有一个不为空，则肯定不会被垃圾回收
-   一个协程处于一个通道的某个协程队列之中，则肯定不会被垃圾回收
-   协程只有在退出后才能被垃圾回收





`select-case`分支流程控制代码块

-   `select`关键字和`{`之间不允许存在任何表达式和语句
-   `fallthrough`语句不能被使用
-   每个`case`关键字后必须跟随一个通道接收数据操作或者一个通道发送数据操作
-   所有的非阻塞case操作中将有一个被随机选择执行
-   所有`case`操作均为阻塞，如果`default`分支存在，则`default`分支代码块将得到执行； 否则，当前协程将被推入所有阻塞操作中相关的通道的发送数据协程队列或者接收数据协程队列中，并进入阻塞状态
-   一个不含任何分支的`select-case`代码块`select{}`将使当前协程处于永久阻塞状态



Pp. 204-216